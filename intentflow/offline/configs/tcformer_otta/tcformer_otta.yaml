# TCFormer OTTA Configuration
# Model: TCFormer + Pmax-SAL Gated Online Test-Time Adaptation

# general
dataset_name: ""
subject_ids: "all"
max_epochs: 500
max_epochs_2b: 500
max_epochs_loso: 125
max_epochs_loso_hgd: 77
seed: 0

# preprocessing
z_scale: True
interaug: True
data_path: "/workspace-cloud/seiya.narukawa/intentflow/data/raw/BCICIV_2a_gdf/"
data_path_2b: "/workspace-cloud/seiya.narukawa/intentflow/data/raw/BCICIV_2b_gdf/"
preprocessing:
  bcic2a:
    sfreq: 250
    low_cut: null
    high_cut: null
    start: 0.0
    stop: 4.0
    batch_size: 48
  bcic2b:
    sfreq: 250
    low_cut: null
    high_cut: null
    start: 0.0
    stop: 3.0
    batch_size: 48
  hgd:
    sfreq: 250
    low_cut: 4
    high_cut: null
    start: 0.0
    stop: 0.0
    batch_size: 48
    remove_artifacts: False

# model
model: "tcformer_otta"
model_kwargs:
  # TCFormer Architecture (same as base TCFormer)
  F1: 32
  temp_kernel_lengths: [20, 32, 64]
  d_group: 16
  D: 2
  pool_length_1: 8
  pool_length_2: 7
  dropout_conv: 0.4
  use_group_attn: True

  # Transformer parameters
  q_heads: 4
  kv_heads: 2
  trans_depth: 2
  trans_dropout: 0.4

  # TCN_head parameters
  tcn_depth: 2
  kernel_length_tcn: 4
  dropout_tcn: 0.3

  # Training parameters (matching TCFormer paper)
  lr: 0.0009
  beta_1: 0.5
  weight_decay: 0.001
  optimizer: "adam"
  scheduler: True
  warmup_epochs: 20
  warmup_epochs_loso: 3

  # OTTA Adaptation Parameters (NEW)
  pmax_threshold: 0.7      # Threshold for pmax confidence
  sal_threshold: 0.5       # Threshold for Source Alignment Level
  enable_otta: true        # Enable/disable adaptation

save_checkpoint: True
