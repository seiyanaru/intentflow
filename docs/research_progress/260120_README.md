# ç ”ç©¶é€²æ—ãƒ­ã‚°ï¼ˆ260120ï¼‰

## 1. ç›®çš„

å‰å›ã®å®Ÿé¨“ï¼ˆ251213â€“260113ï¼‰ã§è¦³æ¸¬ã•ã‚ŒãŸ **BCIC 2a ã®è¢«é¨“è€…å·®ï¼ˆS1åŠ£åŒ–ã€S2/S5æ”¹å–„ï¼‰** ã®åŸå› ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã€2-pass Dynamic Gating ã®è©³ç´°ãƒ‡ãƒãƒƒã‚°ã‚’è¡Œã£ãŸã€‚

---

## 2. å®Ÿé¨“è¨­å®š

### 2.1 å…±é€šè¨­å®š
- **ãƒ¢ãƒ‡ãƒ«**: TCFormer Hybrid with Dynamic Gating
- **ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ**: BCIC Competition IV-2a (9è¢«é¨“è€…)
- **TTTè¨­å®š**: `ttt_reg_lambda=0.05, base_lr=0.05, ttt_loss_scale=0.05`

### 2.2 æ¯”è¼ƒæ¡ä»¶

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å®Ÿé¨“1ï¼ˆä¿å®ˆçš„ï¼‰ | å®Ÿé¨“2ï¼ˆæ”»æ’ƒçš„ï¼‰ |
|-----------|---------------|---------------|
| `entropy_threshold` | 0.85 | **0.6** |
| `entropy_alpha_init_b` | -3.0 | **-1.0** |
| `alpha_max` | 0.3 | **0.5** |

---

## 3. çµæœ

### 3.1 ç²¾åº¦æ¯”è¼ƒ

| è¢«é¨“è€… | å®Ÿé¨“1 | å®Ÿé¨“2 | Î” |
|--------|-------|-------|---|
| S1 | 81.0% | 81.0% | 0 |
| S2 | 75.9% | 75.9% | 0 |
| S3 | 87.9% | 87.9% | 0 |
| S4 | 79.3% | 79.3% | 0 |
| S5 | 79.3% | 79.3% | 0 |
| S6 | 81.0% | 81.0% | 0 |
| S7 | 94.8% | 94.8% | 0 |
| S8 | 86.2% | **91.4%** | **+5.2%** |
| S9 | 84.5% | **82.8%** | **-1.7%** |
| **å¹³å‡** | 83.33% | **83.72%** | +0.39% |

### 3.2 Î±å€¤ãƒ»update_ratio ã®å¤‰åŒ–

| è¢«é¨“è€… | å®Ÿé¨“1 Î± | å®Ÿé¨“2 Î± | å®Ÿé¨“1 update% | å®Ÿé¨“2 update% |
|--------|---------|---------|---------------|---------------|
| S1 | 0.006 | **0.130** | 22% | **76%** |
| S2 | 0.015 | **0.184** | 57% | **97%** |
| S5 | 0.024 | **0.205** | 86% | **100%** |

### 3.3 Flip Analysis

| è¢«é¨“è€… | flip_to_correct | flip_to_wrong | net_flip | acc_change |
|--------|-----------------|---------------|----------|------------|
| S1 | 1 | 1 | 0 | 0% |
| S2 | 0 | 0 | 0 | 0% |
| S5 | 0 | 0 | 0 | 0% |
| **S9** | 0 | **1** | **-1** | **-1.7%** |

---

## 4. åˆ†æ

### 4.1 EntropyGating ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```python
h = gate_entropy - threshold   # threshold = 0.85 or 0.6
z = w * h + b                  # w = 2.0, b = -3.0 or -1.0
alpha = sigmoid(z) * max_out   # max_out = 0.3 or 0.5
```

**å®Ÿé¨“1ï¼ˆä¿å®ˆçš„ï¼‰**: `init_b = -3.0` ã®å¤§ããªè² ã®ãƒã‚¤ã‚¢ã‚¹ã«ã‚ˆã‚Šã€é–¾å€¤ã‚’è¶…ãˆã¦ã‚‚ alpha â‰ˆ 0.016

**å®Ÿé¨“2ï¼ˆæ”»æ’ƒçš„ï¼‰**: `init_b = -1.0` ã¨ä½ã„é–¾å€¤ã«ã‚ˆã‚Šã€alpha â‰ˆ 0.13ã€œ0.20 ã«å¢—åŠ 

### 4.2 S9 ã®è² ã®è»¢ç§»

```json
{
  "acc_pass1": 0.845,
  "acc_pass2": 0.828,
  "n_flip_to_wrong": 1,
  "entropy_p1_flip_to_wrong": 1.09,  // ä¸­ç¨‹åº¦ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼
  "alpha_flip_to_wrong": 0.174,       // é«˜ã„Î±
  "delta_kl_flip_to_wrong": 0.000207  // å¤§ããªå‡ºåŠ›å¤‰åŒ–
}
```

**è§£é‡ˆ**: Pass1ã§æ­£è§£ã—ã¦ã„ãŸã‚µãƒ³ãƒ—ãƒ«ãŒTTTã«ã‚ˆã‚Šèª¤åˆ†é¡ã«è»¢è½ã€‚è«–æ–‡ã§æ‡¸å¿µã•ã‚ŒãŸã€Œéå‰°é©å¿œã«ã‚ˆã‚‹æ±ºå®šå¢ƒç•Œç ´å£Šã€ã®å®Ÿä¾‹ã€‚

### 4.3 å¤šãã®è¢«é¨“è€…ã§ acc_change = 0 ã®ç†ç”±

- Î±å¢—åŠ ã«ã‚ˆã‚Š `delta_logits` ã¯ 0.001 â†’ 0.02 ã«å¢—åŠ 
- ã—ã‹ã— argmax ãŒå¤‰ã‚ã‚‹ã»ã©ã®å¤‰åŒ–ã§ã¯ãªã‹ã£ãŸ
- TTTã®å‡ºåŠ›ãŒAttentionå‡ºåŠ›ã«æ¯”ã¹ã¦ä¾ç„¶ã¨ã—ã¦å°ã•ã„

---

## 5. çµè«–

1. **EntropyGating ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯TTTã®åŠ¹æœã«æ±ºå®šçš„ãªå½±éŸ¿**
   - `init_b = -3.0` ã§ã¯ Î± â‰ˆ 0.01 ã§å®Ÿè³ªçš„ã«TTTç„¡åŠ¹
   - `init_b = -1.0` ã§ã¯ Î± â‰ˆ 0.15 ã§åŠ¹æœãŒç¾ã‚Œå§‹ã‚ã‚‹

2. **è² ã®è»¢ç§»ãƒªã‚¹ã‚¯ãŒå®Ÿé¨“çš„ã«ç¢ºèªã•ã‚ŒãŸ**
   - S9ã§ flip_to_wrong = 1 ãŒç™ºç”Ÿ
   - ä¸­ç¨‹åº¦ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã§ã‚‚TTTç™ºå‹• â†’ éå‰°é©å¿œ

3. **æœ€é©é–¾å€¤ã®æ¢ç´¢ãŒå¿…è¦**
   - `entropy_threshold = 0.6` ã¯æ”»æ’ƒçš„ã™ãã‚‹å¯èƒ½æ€§
   - 0.7ã€œ0.8 ã®ç¯„å›²ã§å†æ¤œè¨ã‚’æ¨å¥¨

---

## 6. çµæœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

```
intentflow/offline/results/
â”œâ”€â”€ TCFormer_Hybrid_bcic2a_seed-42_aug-True_GPU0_20260120_1217/  # å®Ÿé¨“1
â”‚   â”œâ”€â”€ debug_s{1-9}_TCFormer_Hybrid.json
â”‚   â”œâ”€â”€ twopass_s{1-9}_TCFormer_Hybrid.json
â”‚   â””â”€â”€ final_acc_TCFormer_Hybrid.json
â””â”€â”€ TCFormer_Hybrid_bcic2a_seed-42_aug-True_GPU0_20260120_1256/  # å®Ÿé¨“2
    â”œâ”€â”€ debug_s{1-9}_TCFormer_Hybrid.json
    â”œâ”€â”€ twopass_s{1-9}_TCFormer_Hybrid.json
    â””â”€â”€ final_acc_TCFormer_Hybrid.json
```

---

## 8. å®Ÿé¨“3: ä¸­é–“ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ260120_1404ï¼‰

### 8.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å®Ÿé¨“1 | å®Ÿé¨“2 | **å®Ÿé¨“3** |
|-----------|-------|-------|----------|
| `entropy_threshold` | 0.85 | 0.6 | **0.7** |
| `entropy_alpha_init_b` | -3.0 | -1.0 | **-1.5** |
| `alpha_max` | 0.3 | 0.5 | **0.4** |

### 8.2 ç²¾åº¦æ¯”è¼ƒï¼ˆ3å®Ÿé¨“ï¼‰

| è¢«é¨“è€… | å®Ÿé¨“1 | å®Ÿé¨“2 | **å®Ÿé¨“3** | å‚™è€ƒ |
|--------|-------|-------|----------|------|
| S1 | 81.0% | 81.0% | 81.0% | å¤‰åŒ–ãªã— |
| S2 | 75.9% | 75.9% | 75.9% | å¤‰åŒ–ãªã— |
| S5 | 79.3% | 79.3% | 79.3% | å¤‰åŒ–ãªã— |
| S8 | 86.2% | 91.4% | **87.9%** | å®Ÿé¨“3ã§+1.7%æ”¹å–„ |
| S9 | 84.5% | 82.8% | **84.5%** | å®Ÿé¨“2ã®è² è»¢ç§»ãŒè§£æ¶ˆ |
| **å¹³å‡** | 83.33% | 83.72% | **83.52%** | |

### 8.3 ğŸ”µ é‡è¦ãªç™ºè¦‹: S8ã§åˆã®æ­£ã®è»¢ç§»

```json
// S8 (å®Ÿé¨“3)
{
  "acc_pass1": 0.862,
  "acc_pass2": 0.879,          // +1.7% æ”¹å–„
  "n_flip_to_correct": 1,       // TTTãŒèª¤ã‚Šâ†’æ­£è§£ã«ä¿®æ­£
  "n_flip_to_wrong": 0,
  "entropy_p1_flip_to_correct": 1.15,   // é«˜ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼ˆè¿·ã„ï¼‰
  "alpha_flip_to_correct": 0.090,       // é©åº¦ãªÎ±
  "delta_logits_flip_to_correct": 0.021 // å¤§ããªå‡ºåŠ›å¤‰åŒ–
}
```

**è§£é‡ˆ**: Pass1ã§è¿·ã£ã¦ã„ãŸã‚µãƒ³ãƒ—ãƒ«ï¼ˆentropy=1.15ã€pmax=0.41ï¼‰ã‚’TTTãŒæ­£ã—ã„æ–¹å‘ã«ä¿®æ­£

### 8.4 S9: è² ã®è»¢ç§»ãŒè§£æ¶ˆ

| æŒ‡æ¨™ | å®Ÿé¨“2 | å®Ÿé¨“3 |
|------|-------|-------|
| acc_change | -1.7% | **0%** |
| flip_to_wrong | 1 | **0** |
| alphaå¹³å‡ | 0.157 | **0.074** |

**è§£é‡ˆ**: Î±å€¤ãŒ 0.157 â†’ 0.074 ã«åŠæ¸›ã—ã€éå‰°é©å¿œãŒæŠ‘åˆ¶ã•ã‚ŒãŸ

---

## 9. 3å®Ÿé¨“ã®ç·åˆåˆ†æ

### 9.1 Î±å€¤ã®æ¨ç§»

| è¢«é¨“è€… | å®Ÿé¨“1 | å®Ÿé¨“2 | å®Ÿé¨“3 | æœ€é© |
|--------|-------|-------|-------|------|
| S1 | 0.006 | 0.130 | **0.046** | å®Ÿé¨“3 |
| S2 | 0.015 | 0.184 | **0.085** | å®Ÿé¨“3 |
| S5 | 0.024 | 0.205 | **0.102** | å®Ÿé¨“3 |
| S8 | 0.011 | 0.110 | **0.052** | å®Ÿé¨“3 âœ… |
| S9 | 0.016 | 0.157 | **0.074** | å®Ÿé¨“3 âœ… |

### 9.2 Flipç™ºç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³

| å®Ÿé¨“ | flip_to_correct | flip_to_wrong | net_flip |
|------|-----------------|---------------|----------|
| å®Ÿé¨“1 | 0 | 0 | 0 |
| å®Ÿé¨“2 | 1 (S1) | 2 (S1, S9) | -1 |
| **å®Ÿé¨“3** | **1 (S8)** | **0** | **+1** |

### 9.3 çµè«–

1. **æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å®Ÿé¨“3ã®è¨­å®š**
   - `entropy_threshold = 0.7`
   - `entropy_alpha_init_b = -1.5`
   - `alpha_max = 0.4`

2. **TTTã®æ­£ã®åŠ¹æœãŒåˆã‚ã¦ç¢ºèªã•ã‚ŒãŸ**
   - S8: Pass1ã§è¿·ã£ã¦ã„ãŸã‚µãƒ³ãƒ—ãƒ«ã‚’TTTãŒæ­£è§£ã«ä¿®æ­£
   - é«˜ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã‚µãƒ³ãƒ—ãƒ«ã§ã®é©å¿œãŒæœ‰åŠ¹

3. **éå‰°é©å¿œãƒªã‚¹ã‚¯ã‚‚åˆ¶å¾¡å¯èƒ½**
   - å®Ÿé¨“2ã§ç™ºç”Ÿã—ãŸS9ã®è² ã®è»¢ç§»ãŒå®Ÿé¨“3ã§è§£æ¶ˆ
   - Î±å€¤ã‚’é©åº¦ã«æŠ‘ãˆã‚‹ã“ã¨ãŒé‡è¦

---

## 10. ãƒ¢ãƒ‡ãƒ«å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 10.1 TCFormer Hybrid ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph TD
    A[EEG Input: BÃ—CÃ—T] --> B[Conv Feature Extraction]
    B --> C[Hybrid Encoder]
    
    subgraph Hybrid Encoder
        C --> D{Dynamic Gating?}
        D -->|Yes| E[Pass 1: Attention-only]
        E --> F[Entropyè¨ˆç®—]
        F --> G[EntropyGating: Î±, lr_scale]
        G --> H[Pass 2: Attention + Î±Ã—TTT]
        D -->|No| I[Static: Attention + TTT]
    end
    
    H --> J[TCN Head]
    I --> J
    J --> K[Classification Output]
```

### 10.2 EntropyGating ã®è©³ç´°

```python
# Pass 1: Attention-only ã§ provisional logits ã‚’å–å¾—
logits_p1 = model(x, enable_ttt=False)
entropy = -sum(softmax(logits_p1) * log(softmax(logits_p1)))
gate_entropy = entropy / max_entropy  # æ­£è¦åŒ– [0, 1]

# Gating è¨ˆç®—
h = gate_entropy - threshold           # é–¾å€¤ã¨ã®å·®åˆ†
alpha = sigmoid(w * h + b) * alpha_max  # [0, alpha_max]
lr_scale = sigmoid(w * h + b') * lr_scale_max

# Pass 2: TTT é©å¿œä»˜ã
logits_p2 = model(x, enable_ttt=True, alpha=alpha, lr_scale=lr_scale)
```

### 10.3 TTT (Test-Time Training) Layer

```python
# TTTLinear forward (per-sample adaptation)
# å…¥åŠ›: X = [B, T, D]

# 1. KV projection
K = X @ W_k  # [B, T, head_dim]
V = X @ W_v  # [B, T, head_dim]

# 2. Self-supervised loss (reconstruction)
Z = X @ W1                    # ç·šå½¢å¤‰æ›
target = X                    # å†æ§‹æˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
loss = MSE(Z, target) + lambda * ||W1 - W1_init||^2  # æ­£å‰‡åŒ–

# 3. Gradient descent (per-sample)
W1 = W1 - lr_scale * base_lr * grad(loss)

# 4. Output
out = Z @ W_out + attention_out
```

---

## 11. HGD ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¤œè¨¼çµæœ

### 11.1 å•é¡Œç‚¹

HGD ã§å®Ÿé¨“3è¨­å®šã‚’è©¦ã—ãŸã¨ã“ã‚ã€**base ãƒ¢ãƒ‡ãƒ«è‡ªä½“ã®ç²¾åº¦ãŒä½ä¸‹**ï¼š

| è¢«é¨“è€… | Acc | å•é¡Œç‚¹ |
|--------|-----|--------|
| S1 | 63.1% | hand(L) ã® 80% ãŒ hand(R) ã«èª¤åˆ†é¡ |
| S2 | 74.4% | rest ã® 72.5% ãŒ feet ã«èª¤åˆ†é¡ |

### 11.2 åŸå› åˆ†æ

- HGD ã¯ BCIC 2a ã‚ˆã‚Šé›£ã—ã„ï¼ˆ4ã‚¯ãƒ©ã‚¹ã€ç•°ãªã‚‹ä¿¡å·ç‰¹æ€§ï¼‰
- **TTTã®å•é¡Œã§ã¯ãªãã€Base ãƒ¢ãƒ‡ãƒ«ã®å•é¡Œ**
- `entropy_threshold = 0.7` ãŒHGDã«ã¯ä½ã™ãã‚‹å¯èƒ½æ€§

### 11.3 ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆéä¾å­˜ã®èª²é¡Œ

ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼é–¾å€¤ã¯**çµ¶å¯¾å€¤**ã§è¨­å®šã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒå¿…è¦ã¨ã„ã†å•é¡ŒãŒã‚ã‚‹ã€‚

---

## 12. æ¬¡ã®æ–½ç­–æ¡ˆ

### Option A: Percentile-based Thresholdï¼ˆæ¨å¥¨ï¼‰

```python
# ãƒ†ã‚¹ãƒˆé–‹å§‹æ™‚ã«è¢«é¨“è€…ã”ã¨ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼åˆ†å¸ƒã‚’æ¨å®š
# ä¸Šä½ X% ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã®ã¿ TTT ç™ºå‹•
threshold = torch.quantile(gate_entropy_buffer, 0.8)
```

**ãƒ¡ãƒªãƒƒãƒˆ**: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ»è¢«é¨“è€…éä¾å­˜

### Option B: TTTå†…éƒ¨ã®é©å¿œå¼·åº¦ã‚’ä¸Šã’ã‚‹

```yaml
ttt_config:
  base_lr: 0.1       # 0.05 â†’ 0.1
  ttt_loss_scale: 0.1  # 0.05 â†’ 0.1
```

**ãƒªã‚¹ã‚¯**: å‹¾é…çˆ†ç™ºã€éå‰°é©å¿œ

### Option C: é€£ç¶šã‚²ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆé–¾å€¤ãªã—ï¼‰

```python
# hard_off_below_threshold = False
# å…¨ã‚µãƒ³ãƒ—ãƒ«ã§é€£ç¶šçš„ã«Î±é©ç”¨
alpha = sigmoid(w * gate_entropy + b) * alpha_max
```

### Option D: Reconstruction Error Gateï¼ˆPonderTTTçš„ï¼‰

TTTå†…éƒ¨ã®å†æ§‹æˆèª¤å·®ã‚’è¿½åŠ çš„ãªã‚²ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¿¡å·ã¨ã—ã¦ä½¿ç”¨ï¼š

```python
recon_error = ||Z - X||^2
gate_signal = combine(entropy, recon_error)
```

---

## 13. æœ¬æ—¥ã®çµè«–

1. **EntropyGating ã¯æ©Ÿèƒ½ã™ã‚‹ãŒã€ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒ critical**
   - ä¿å®ˆçš„ã™ãã‚‹ (exp1): TTT ãŒå®Ÿè³ªç„¡åŠ¹
   - æ”»æ’ƒçš„ã™ãã‚‹ (exp2): è² ã®è»¢ç§»ãƒªã‚¹ã‚¯
   - ä¸­é–“è¨­å®š (exp3): åˆã‚ã¦æ­£ã®è»¢ç§»ã‚’ç¢ºèªï¼ˆS8ï¼‰

2. **TTT ã®åŠ¹æœã¯è¢«é¨“è€…ä¾å­˜**
   - é«˜ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼è¢«é¨“è€…ï¼ˆS4, S5, S6ï¼‰: TTT ã®æ©æµã‚’å—ã‘ã‚„ã™ã„
   - ä½ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼è¢«é¨“è€…ï¼ˆS1, S7ï¼‰: TTT ã¯ä¸è¦

3. **ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆéä¾å­˜ã®ã‚²ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒä»Šå¾Œã®èª²é¡Œ**
   - çµ¶å¯¾é–¾å€¤ â†’ ç›¸å¯¾é–¾å€¤ï¼ˆpercentile-basedï¼‰ã¸ã®ç§»è¡Œã‚’æ¤œè¨
   - EATA, SAR ãªã©ã®å…ˆè¡Œç ”ç©¶ã‚’å‚è€ƒã«

---

## 14. çµæœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§

| å®Ÿé¨“ | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | è¨­å®š |
|------|-------------|------|
| å®Ÿé¨“1 | `20260120_1217` | threshold=0.85, init_b=-3.0, max=0.3 |
| å®Ÿé¨“2 | `20260120_1256` | threshold=0.6, init_b=-1.0, max=0.5 |
| å®Ÿé¨“3 | `20260120_1404` | threshold=0.7, init_b=-1.5, max=0.4 |
| HGD | `20260120_1448` | å®Ÿé¨“3è¨­å®šã§HGDæ¤œè¨¼ |
| **å®Ÿé¨“4** | `20260120_2044` | threshold=0.65, init_b=-1.0, max=0.5, ttt_loss_scale=0.1 |

---

## 15. å®Ÿé¨“4: TTTåŠ¹æœã®é¡•åœ¨åŒ–ï¼ˆ260120_2044ï¼‰

### 15.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å®Ÿé¨“3 | **å®Ÿé¨“4** |
|-----------|-------|----------|
| `entropy_threshold` | 0.7 | **0.65** |
| `entropy_alpha_init_b` | -1.5 | **-1.0** |
| `alpha_max` | 0.4 | **0.5** |
| `ttt_loss_scale` | 0.05 | **0.1** |

### 15.2 çµæœã‚µãƒãƒªãƒ¼

| Subject | Acc_P1 | Acc_P2 | Î” | Î± | flip+ | flip- | net |
|---------|--------|--------|---|---|-------|-------|-----|
| **S1** | 86.2% | **87.9%** | **+1.7%** | 0.131 | **1** | 0 | **+1** |
| S2 | 72.4% | 70.7% | -1.7% | 0.173 | 0 | 1 | -1 |
| S3 | 84.5% | 82.8% | -1.7% | 0.082 | 0 | 1 | -1 |
| **S4** | 72.4% | **74.1%** | **+1.7%** | 0.186 | **1** | 0 | **+1** |
| S5 | 72.4% | 72.4% | 0% | 0.177 | 0 | 0 | 0 |
| S6 | 81.0% | 81.0% | 0% | 0.182 | 0 | 0 | 0 |
| S7 | 96.6% | 96.6% | 0% | 0.078 | 0 | 0 | 0 |
| S8 | 84.5% | 84.5% | 0% | 0.105 | 0 | 0 | 0 |
| S9 | 82.8% | 81.0% | -1.7% | 0.141 | 0 | 1 | -1 |
| **Total** | | **81.23%** | | | **2** | **3** | **-1** |

### 15.3 è©³ç´°Flipåˆ†æ

#### æ­£ã®è»¢ç§» (flip_to_correct)

| Subject | Sample | å¤‰åŒ– | entropy | pmax | Î± | delta_logits |
|---------|--------|------|---------|------|---|--------------|
| S1 | 0 | Tongueâ†’Feet | **1.093** | **0.433** | 0.163 | 0.037 |
| S4 | 52 | Leftâ†’Tongue | **1.380** | **0.277** | 0.212 | 0.014 |

#### è² ã®è»¢ç§» (flip_to_wrong)

| Subject | Sample | å¤‰åŒ– | entropy | pmax | Î± | delta_logits |
|---------|--------|------|---------|------|---|--------------|
| S2 | 1 | Feetâ†’Right | 1.271 | 0.338 | 0.193 | 0.007 |
| S2 | 56 | Leftâ†’Right | 1.113 | 0.427 | 0.167 | 0.008 |
| S3 | 28 | Feetâ†’Tongue | 1.071 | 0.440 | 0.160 | 0.017 |
| S9 | 50 | Rightâ†’Left | 1.325 | 0.311 | 0.202 | 0.055 |

### 15.4 ğŸ”‘ Key Insight: æ­£è² Flipã®å·®ç•°

| æŒ‡æ¨™ | Positive Flip | Negative Flip | å·® |
|------|---------------|---------------|---|
| Entropy P1 | **1.237** | 1.195 | +0.042 |
| pmax P1 | **0.355** | 0.379 | -0.024 |
| Alpha | 0.188 | 0.180 | +0.008 |
| delta_logits | 0.025 | 0.022 | +0.003 |

**çµè«–**:
- **æ­£ã®è»¢ç§»**: ãƒ¢ãƒ‡ãƒ«ãŒã€Œæœ¬å½“ã«è¿·ã£ã¦ã„ã‚‹ã€ã‚µãƒ³ãƒ—ãƒ«ï¼ˆé«˜ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã€ä½pmaxï¼‰
- **è² ã®è»¢ç§»**: ãƒ¢ãƒ‡ãƒ«ãŒã€Œã‚„ã‚„è‡ªä¿¡ãŒã‚ã‚‹ã€ã‚µãƒ³ãƒ—ãƒ«ï¼ˆä¸­ç¨‹åº¦ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã€ä¸­pmaxï¼‰

### 15.5 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—æ¡ˆ

1. **pmax-based ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: `pmax < 0.35` ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã®ã¿TTTç™ºå‹•
2. **Entropy + pmax è¤‡åˆæ¡ä»¶**: `entropy > 1.2 AND pmax < 0.4` ã§ãƒ•ã‚£ãƒ«ã‚¿
3. **EATAçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: ä¿¡é ¼ã§ãã‚‹ã‚µãƒ³ãƒ—ãƒ«ã®ã¿ã§é©å¿œ

---

## 16. æœ€çµ‚çµè«–

### 16.1 4å®Ÿé¨“ã®æ¯”è¼ƒ

| å®Ÿé¨“ | å¹³å‡ç²¾åº¦ | flip+ | flip- | net | ç‰¹å¾´ |
|------|---------|-------|-------|-----|------|
| å®Ÿé¨“1 | 83.33% | 0 | 0 | 0 | TTTå®Ÿè³ªç„¡åŠ¹ |
| å®Ÿé¨“2 | 83.72% | 1 | 2 | -1 | æ”»æ’ƒçš„ã™ãã‚‹ |
| å®Ÿé¨“3 | 83.52% | 1 | 0 | +1 | ãƒãƒ©ãƒ³ã‚¹è‰¯ã„ |
| å®Ÿé¨“4 | 81.23% | 2 | 3 | -1 | TTTåŠ¹æœã‚ã‚Šä½†ã—è² ã‚‚å¢—åŠ  |

### 16.2 ç ”ç©¶æ–¹å‘æ€§

1. **å•é¡Œ**: ç¾åœ¨ã®EntropyGatingã§ã¯æ­£è² ã®flipãŒæ‹®æŠ—
2. **è§£æ±ºç­–**: ã€Œä¿¡é ¼ã§ãã‚‹ã‚µãƒ³ãƒ—ãƒ«ã€ã®ã¿ã§é©å¿œã™ã‚‹æ©Ÿæ§‹ãŒå¿…è¦
3. **å…·ä½“æ¡ˆ**: 
   - Percentile-based thresholdï¼ˆç›¸å¯¾é–¾å€¤ï¼‰
   - pmaxæ¡ä»¶ã®è¿½åŠ ï¼ˆä½ç¢ºä¿¡åº¦ã‚µãƒ³ãƒ—ãƒ«ã®ã¿ï¼‰
   - EATA/SARçš„ãªgradient filtering

